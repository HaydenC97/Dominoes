#!/usr/bin/env python
"""
A simple script that translates desired gripper width to command for
JointGroupPositionController.
"""
import rospy
import math
from std_msgs.msg import Float64MultiArray, MultiArrayDimension, Float64
from geometry_msgs.msg import Pose
from gazebo_msgs.srv import SpawnModel

pause = 1.5 #time between instructions, seconds

def set_joints(joints):
	for i in range(7):
		joint_publishers[i].publish(joints[i])
	rospy.sleep(pause)

def gripper_open():
	msg.data = [0.06, 0.06]
	gripper_publishers.publish(msg)
	rospy.sleep(pause)

def gripper_close():
	msg.data = [0, 0]
	gripper_publishers.publish(msg)
	rospy.sleep(pause)

if __name__ == '__main__':
	rospy.init_node('joint_gripper')

	#set initial joint angles and gripper position
	joints = [0, 1*math.pi/8, 0, 1*math.pi/8, 0, 6*math.pi/8, -math.pi/4]
	gripper = [0.0,0.0]

	#load in publishers for arm and gripper
	joint_publishers = [rospy.Publisher('/franka/joint{}_position_controller/command'.format(i), Float64, queue_size=1) for i in range(1, 8)]
	gripper_publishers = rospy.Publisher('/franka/gripper_position_controller/command', Float64MultiArray, queue_size=1)

	msg = Float64MultiArray()
	msg.layout.dim = [MultiArrayDimension('', 2, 1)]
	data = 0
	msg.data = gripper

	start = rospy.Time.now()

	#set starting pose
	rospy.loginfo("Setting initial pose.")
	set_joints(joints)
	gripper_close()
	rospy.sleep(pause*5)

	rospy.loginfo("Starting loop.")
	rate = rospy.Rate(10)
	while not rospy.is_shutdown():

		# Brick 1
		gripper_open()
		set_joints([4.55552479252e-05, -0.785354883685, 3.85594129097e-05, -1.57073302208, 0.0, 1.04716240607, -5.65796712879e-05])
		# going down
		set_joints([-0.935571002378, -0.794279023922, 0.00106256604729, -2.20235400073, 0.0, 1.40897740596, -1.72033269154])
		set_joints([-0.931682874744, -0.372861882887, -0.00168355862037, -1.23020078497, 0.0, 0.857593434935, -1.71915462759])
		set_joints([-0.935955324335, -0.864202084657, 0.00138103334197, -2.44630709066, 0.0, 1.58146283708, -1.720462275])
		gripper_close()
		set_joints([-0.933269549654, -0.562332751049, -0.00141027431361, -3.05898029669, 0.0, 2.49554377459, -1.71892164157])
		# going up

		set_joints([-0.933269549654, -0.562332751049, -0.00141027431361, -3.05898029669, 0.0, 2.49554377459, -1.71892164157])
		set_joints([-0.933269549654, -0.562332751049, -0.00141027431361, -3.05898029669, 0.0, 2.49554377459, -1.71892164157])
		set_joints([-0.933015742722, -0.89159393498, -0.00102368820601, -2.73431012644, 0.0, 1.84298019423, -1.71911225442])
		set_joints([-0.93285155309, -0.793800403231, -0.000968294370352, -2.20163617778, 0.0, 1.40676036363, -1.71793097292])
		set_joints([2.78611008277, -0.156992673913, 0.00612936785404, -1.68464472063, 0.0, 1.52760772181, 2.00758201486])
		# going down
		set_joints([2.78611008277, -0.156992673913, 0.00612936785404, -1.68464472063, 0.0, 1.52760772181, 2.00758201486])
		set_joints([2.78611008277, -0.156992673913, 0.00612936785404, -1.68464472063, 0.0, 1.52760772181, 2.00758201486])
		set_joints([2.78848661972, -0.166702507912, 0.00398980931354, -2.17067438204, 0.0, 2.00391376022, -0.785155128336])
		gripper_open()
		set_joints([2.79524462478, 0.0934169083575, -0.00259945276594, -2.3884678138, 0.0, 2.48175133516, -0.78463259687])
		# going up

		set_joints([2.79524462478, 0.0934169083575, -0.00259945276594, -2.3884678138, 0.0, 2.48175133516, -0.78463259687])
		set_joints([2.79524462478, 0.0934169083575, -0.00259945276594, -2.3884678138, 0.0, 2.48175133516, -0.78463259687])
		set_joints([2.79052446911, -0.166840069339, 0.00214376805158, -2.17089851192, 0.0, 2.00474692784, -0.784954409384])

		# Brick 2
		gripper_open()
		set_joints([2.78743750756, -0.156897529319, 0.00485622014659, -1.68459235607, 0.0, 1.52713348324, -0.785717280315])
		# going down
		set_joints([-0.753060703193, -0.259677809281, -0.00188173885356, -1.79121380577, 0.0, 1.53066746467, -1.54042124838])
		set_joints([-0.750811393473, -0.260452690351, -0.00372507030175, -1.79270065633, 0.0, 1.5323452483, -1.5391231682])
		set_joints([-0.756869545536, -0.267583069011, 0.00183533598476, -2.2747448722, 0.0, 2.00691326034, -1.53955185136])
		gripper_close()
		set_joints([-0.756869545536, -0.267583069011, 0.00183533598476, -2.2747448722, 0.0, 2.00691326034, -1.53955185136])
		# going up

		set_joints([-0.756869545536, -0.267583069011, 0.00183533598476, -2.2747448722, 0.0, 2.00691326034, -1.53955185136])
		set_joints([-0.756869545536, -0.267583069011, 0.00183533598476, -2.2747448722, 0.0, 2.00691326034, -1.53955185136])
		set_joints([-0.756869545536, -0.267583069011, 0.00183533598476, -2.2747448722, 0.0, 2.00691326034, -1.53955185136])
		set_joints([-0.751362098619, -0.260550897929, -0.00336975153765, -1.79256995333, 0.0, 1.53287352236, -1.54058445041])
		set_joints([-0.751362098619, -0.260550897929, -0.00336975153765, -1.79256995333, 0.0, 1.53287352236, -1.54058445041])
		# going down
		set_joints([-0.751362098619, -0.260550897929, -0.00336975153765, -1.79256995333, 0.0, 1.53287352236, -1.54058445041])
		set_joints([2.78926373863, -0.157187063656, 0.00319330090998, -1.68495771797, 0.0, 1.52861696392, -0.785740183957])
		set_joints([2.7983845474, -0.195374185405, -0.00524098205837, -1.9445542763, 0.0, 1.74907597452, -0.784302805595])
		gripper_open()
		set_joints([2.7869092947, -0.175888044285, 0.00559267482312, -2.14131413997, 0.0, 1.96549945719, -0.784811853342])
		# going up

		set_joints([2.7869092947, -0.175888044285, 0.00559267482312, -2.14131413997, 0.0, 1.96549945719, -0.784811853342])
		set_joints([2.7869092947, -0.175888044285, 0.00559267482312, -2.14131413997, 0.0, 1.96549945719, -0.784811853342])
		set_joints([2.78980947099, -0.195301295727, 0.00261381639072, -1.94467068117, 0.0, 1.74875408546, -0.786620849346])

		# Brick 3
		gripper_open()
		set_joints([2.79151715878, -0.157624273695, 0.00112411213976, -1.68553549113, 0.0, 1.52888640469, -0.786088889033])
		# going down
		set_joints([-1.08243841008, -0.571501982686, -0.000110813736184, -2.060210196, 0.0, 1.48817197992, -1.86756659945])
		set_joints([-1.08243841008, -0.571501982686, -0.000110813736184, -2.060210196, 0.0, 1.48817197992, -1.86756659945])
		set_joints([-1.08424785763, -0.607205418778, 0.0016551282669, -2.5624414231, 0.0, 1.95482765415, -1.86864857482])
		gripper_close()
		set_joints([-1.08035566731, -0.281741070624, -0.00221520820615, -2.8308260428, 0.0, 2.5492303153, -1.8675028968])
		# going up

		set_joints([-1.08035566731, -0.281741070624, -0.00221520820615, -2.8308260428, 0.0, 2.5492303153, -1.8675028968])
		set_joints([-1.08035566731, -0.281741070624, -0.00221520820615, -2.8308260428, 0.0, 2.5492303153, -1.8675028968])
		set_joints([-1.08144906925, -0.607047004047, -0.00106575719941, -2.5621304612, 0.0, 1.95385652908, -1.86865014684])
		set_joints([-1.07946060896, -0.571975280789, -0.00222467900293, -2.06080390145, 0.0, 1.4893991407, -1.86633298711])
		set_joints([2.44970600494, -0.158218114318, -0.00516760665409, -1.68582135697, 0.0, 1.52708084169, 1.65855989182])
		# going down
		set_joints([2.44046717191, -0.158586413294, 0.00325072781749, -1.68654596568, 0.0, 1.52856558976, -0.786492230927])
		set_joints([2.44046717191, -0.158586413294, 0.00325072781749, -1.68654596568, 0.0, 1.52856558976, -0.786492230927])
		set_joints([2.44323281338, -0.16788625206, 0.000697057736895, -2.17172939911, 0.0, 2.00365412319, -0.785932179949])
		gripper_open()
		set_joints([2.44118443851, 0.092557349781, 0.00288382198074, -2.39027472333, 0.0, 2.48359508446, -0.785676471832])
		# going up

		set_joints([2.44118443851, 0.092557349781, 0.00288382198074, -2.39027472333, 0.0, 2.48359508446, -0.785676471832])
		set_joints([2.44118443851, 0.092557349781, 0.00288382198074, -2.39027472333, 0.0, 2.48359508446, -0.785676471832])
		set_joints([2.44420761736, -0.167684485414, -0.00021224673716, -2.17148494562, 0.0, 2.00249199996, -0.785457028461])

		# Brick 4
		gripper_open()
		set_joints([2.44302630224, -0.157981036276, 0.00101172937173, -1.68536985187, 0.0, 1.52631346872, -0.784863246973])
		# going down
		set_joints([-1.56942378021, -0.695139229849, -0.000939912177041, -2.14415078066, 0.0, 1.44871527274, -2.35622116301])
		set_joints([-1.56942378021, -0.695139229849, -0.000939912177041, -2.14415078066, 0.0, 1.44871527274, -2.35622116301])
		set_joints([-1.56905073786, -0.760158806476, -0.00153485797633, -2.66206574775, 0.0, 1.90198754545, -2.35512328006])
		gripper_close()
		set_joints([-1.5715586718, -0.425371700335, 0.000757882305083, -2.95854072543, 0.0, 2.53342582769, -2.35601200111])
		# going up

		set_joints([-1.5715586718, -0.425371700335, 0.000757882305083, -2.95854072543, 0.0, 2.53342582769, -2.35601200111])
		set_joints([-1.5715586718, -0.425371700335, 0.000757882305083, -2.95854072543, 0.0, 2.53342582769, -2.35601200111])
		set_joints([-1.5702111413, -0.760217964922, -0.000536278306434, -2.66227282601, 0.0, 1.90191839705, -2.35604347522])
		set_joints([-1.56920496555, -0.695543468586, -0.00114206860273, -2.14455805758, 0.0, 1.44890680331, -2.35609816902])
		set_joints([2.4372282034, -0.158548867796, 0.00615961670326, -1.68641846651, 0.0, 1.52782353671, 1.65851338749])
		# going down
		set_joints([2.4372282034, -0.158548867796, 0.00615961670326, -1.68641846651, 0.0, 1.52782353671, 1.65851338749])
		set_joints([2.4372282034, -0.158548867796, 0.00615961670326, -1.68641846651, 0.0, 1.52782353671, 1.65851338749])
		set_joints([2.44398725762, -0.196178630004, 0.000192049021171, -1.94538018312, 0.0, 1.74796545806, -0.784960735047])
		gripper_open()
		set_joints([2.44402921687, -0.177561349527, -2.20406682022e-05, -2.14333710779, 0.0, 1.96676163723, -0.785251241634])
		# going up

		set_joints([2.44402921687, -0.177561349527, -2.20406682022e-05, -2.14333710779, 0.0, 1.96676163723, -0.785251241634])
		set_joints([2.44402921687, -0.177561349527, -2.20406682022e-05, -2.14333710779, 0.0, 1.96676163723, -0.785251241634])
		set_joints([2.44784048067, -0.19674551278, -0.00358975274104, -1.94619342144, 0.0, 1.74935398372, -0.785609138863])

		# Brick 5
		gripper_open()
		set_joints([2.44104992983, -0.158527118356, 0.0027258680568, -1.68648890956, 0.0, 1.52891911747, -0.78660289487])
		# going down
		set_joints([-2.05744055287, -0.57158348766, -0.00143867030486, -2.06049567395, 0.0, 1.4886639887, -2.84313255022])
		set_joints([-2.05744055287, -0.57158348766, -0.00143867030486, -2.06049567395, 0.0, 1.4886639887, -2.84313255022])
		set_joints([-2.0594648572, -0.606725225212, 0.000513115279494, -2.56202413648, 0.0, 1.95434711739, -2.84370631052])
		gripper_close()
		set_joints([-2.06156599593, -0.281181304625, 0.00245471537175, -2.8302290416, 0.0, 2.54818683993, -2.84456051854])
		# going up

		set_joints([-2.06156599593, -0.281181304625, 0.00245471537175, -2.8302290416, 0.0, 2.54818683993, -2.84456051854])
		set_joints([-2.06156599593, -0.281181304625, 0.00245471537175, -2.8302290416, 0.0, 2.54818683993, -2.84456051854])
		set_joints([-2.06102604505, -0.607111966978, 0.00182136899864, -2.56268794869, 0.0, 1.95606733181, -2.84475723596])
		set_joints([-2.05735447916, -0.572000896865, -0.00145707295661, -2.06082622336, 0.0, 1.48941140315, -2.84447567011])
		set_joints([-2.05735447916, -0.572000896865, -0.00145707295661, -2.06082622336, 0.0, 1.48941140315, -2.84447567011])
		# going down
		set_joints([-2.05735447916, -0.572000896865, -0.00145707295661, -2.06082622336, 0.0, 1.48941140315, -2.84447567011])
		set_joints([2.09611146154, -0.157871119515, -0.00157062333822, -1.68540108184, 0.0, 1.52817998738, -0.784309284052])
		set_joints([2.0891345795, -0.16706689281, 0.00522930262998, -2.17106059194, 0.0, 2.00431283175, -0.784517003894])
		gripper_open()
		set_joints([2.09751117595, 0.0929414622535, -0.0030731350857, -2.38916753164, 0.0, 2.4820254974, -0.785706786436])
		# going up

		set_joints([2.09751117595, 0.0929414622535, -0.0030731350857, -2.38916753164, 0.0, 2.4820254974, -0.785706786436])
		set_joints([2.09751117595, 0.0929414622535, -0.0030731350857, -2.38916753164, 0.0, 2.4820254974, -0.785706786436])
		set_joints([2.09200723225, -0.166820207276, 0.00234788733849, -2.17062569367, 0.0, 2.00289826708, -0.785181143281])

		# Brick 6
		gripper_open()
		set_joints([2.09786350626, -0.157581767736, -0.00304127581477, -1.68533657708, 0.0, 1.52787568773, -0.78567480764])
		# going down
		set_joints([2.09786350626, -0.157581767736, -0.00304127581477, -1.68533657708, 0.0, 1.52787568773, -0.78567480764])
		set_joints([2.09786350626, -0.157581767736, -0.00304127581477, -1.68533657708, 0.0, 1.52787568773, -0.78567480764])
		set_joints([2.09786350626, -0.157581767736, -0.00304127581477, -1.68533657708, 0.0, 1.52787568773, -0.78567480764])
		gripper_close()
		set_joints([2.09786350626, -0.157581767736, -0.00304127581477, -1.68533657708, 0.0, 1.52787568773, -0.78567480764])
		# going up

		set_joints([2.09786350626, -0.157581767736, -0.00304127581477, -1.68533657708, 0.0, 1.52787568773, -0.78567480764])
		set_joints([2.09786350626, -0.157581767736, -0.00304127581477, -1.68533657708, 0.0, 1.52787568773, -0.78567480764])
